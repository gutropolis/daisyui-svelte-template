import{sequence as e}from"@sveltejs/kit/hooks";import{b as s,v as r,s as t,d as a}from"./auth.js";import{o as n,s as o,a as l,d as c,b as u}from"./runtime.js";const i=e(({event:e,resolve:s})=>async function(e,s){if(u)u||n(function(){let e;return{getStore:()=>e,async run(s,r){e=s;try{return await r()}finally{e=void 0}}}}());else{const{AsyncLocalStorage:e}=await import("async_hooks");n(new e)}const r=await o({request:e}),t=r.locale,a=new URL(e.url).origin;if("document"===e.headers.get("Sec-Fetch-Dest")&&r.shouldRedirect&&r.redirectUrl){const e={};return l.includes("preferredLanguage")&&(e.Vary="Accept-Language"),new Response(null,{status:307,headers:{Location:r.redirectUrl.href,...e}})}const i=l.includes("url")?new Request(c(e.url),e):new Request(e),d=new Set;return await(u?.run({locale:t,origin:a,messageCalls:d},()=>s({locale:t,request:i})))}(e.request,({request:r,locale:t})=>(e.request=r,s(e,{transformPageChunk:({html:e})=>e.replace("%paraglide.lang%",t)}))),async({event:e,resolve:n})=>{const o=e.cookies.get(s);if(!o)return e.locals.user=null,e.locals.session=null,n(e);const{session:l,user:c}=await r(o);return l?t(e,o,l.expiresAt):a(e),e.locals.user=c,e.locals.session=l,n(e)});export{i as handle};
